<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Napt√°r Pro - Val√≥s idej≈± adatokkal</title>
    <meta name="description" content="Interakt√≠v napt√°r val√≥s idej≈± id≈ëj√°r√°s-el≈ërejelz√©ssel, holdf√°zisokkal, n√©vnapokkal, jeles napokkal, √©vfordul√≥kkal √©s csillag√°szati adatokkal a vil√°g b√°rmely pontj√°ra.">
    <meta name="keywords" content="napt√°r, id≈ëj√°r√°s, holdf√°zis, n√©vnap, jeles napok, vil√°gnapok, csillag√°szat, √≥ra, id≈ëz√≥na, Magyarorsz√°g">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; min-height: 100vh; padding: 10px; transition: background 1s ease; color: #333; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .morning { background: linear-gradient(135deg, #fff5b5 0%, #ffce45 100%); }
        .afternoon { background: linear-gradient(135deg, #87ceeb 0%, #4a90e2 100%); }
        .evening { background: linear-gradient(135deg, #ff6b6b 0%, #4e54c8 100%); }
        .night { background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%); color: #fff; }
        .container { width: 100%; max-width: 1400px; margin: 0 auto; }
        header, main, section, article { display: block; }
        .location-bar { background: rgba(255, 255, 255, 0.9); border-radius: 20px; padding: 10px 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); flex-wrap: wrap; }
        .night .location-bar { background: rgba(255, 255, 255, 0.1); color: #fff; }
        .main-info { background: rgba(255, 255, 255, 0.9); border-radius: 20px; padding: 20px; margin-bottom: 15px; text-align: center; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); }
        .night .main-info { background: rgba(255, 255, 255, 0.1); }
        .current-day { font-size: 1.8em; font-weight: 300; margin-bottom: 10px; }
        .day-stats { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-top: 15px; }
        .stat-item { text-align: center; flex: 1 1 80px; }
        .stat-value { font-size: 1.5em; font-weight: 600; color: #4a90e2; }
        .night .stat-value { color: #87ceeb; }
        .stat-label { font-size: 0.85em; opacity: 0.8; }
        .timezone-details { font-size: 0.75em; color: #666; margin-top: 2px; line-height: 1.2; }
        .night .timezone-details { color: #aaa; }
        .main-section { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .info-card { background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); display: flex; flex-direction: column; }
        .night .info-card { background: rgba(255, 255, 255, 0.1); }
        .info-card h3 { margin-bottom: 15px; font-weight: 500; display: flex; align-items: center; gap: 10px; font-size: 1.1em; }
        .weather-alert { background: #ff6b6b; color: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; display: none; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .weather-icon { font-size: 3em; margin: 10px 0; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-top: 10px; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 5px; cursor: pointer; font-size: 0.9em; padding: 2px; background: rgba(0, 0, 0, 0.05); position: relative; min-height: 35px; }
        .night .calendar-day { background: rgba(255, 255, 255, 0.05); }
        .calendar-day:hover { background: rgba(74, 144, 226, 0.3); transform: scale(1.05); }
        .calendar-day.holiday { background: rgba(255, 107, 107, 0.2); color: #e74c3c; font-weight: bold; }
        .calendar-day.sunday { color: #e74c3c; }
        .calendar-day.today { background: #4a90e2; color: white; font-weight: bold; box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5); }
        .moon-visual { width: 150px; height: 150px; border-radius: 50%; margin: 15px auto; position: relative; box-shadow: inset -10px -10px 20px rgba(0, 0, 0, 0.1), 0 0 10px rgba(255, 255, 255, 0.3); overflow: hidden; background-color: #e0e0e0; }
        .moon-phase-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; transition: transform 0.5s ease-in-out; background-color: #2c2c2c; }
        .world-clock-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 20px; }
        .time-zone-card { text-align: center; padding: 10px; background: rgba(0, 0, 0, 0.05); border-radius: 10px; transition: transform 0.2s; font-size: 0.9em; }
        .night .time-zone-card { background: rgba(255, 255, 255, 0.05); }
        .time-zone-card:hover { transform: translateY(-3px); }
        .sun-icon { color: #ffce45; font-size: 1.5em; }
        .moon-icon { color: #b8c6db; font-size: 1.5em; }
        input, select, button { padding: 10px; border: 2px solid transparent; border-radius: 10px; font-size: 14px; background: rgba(255, 255, 255, 0.8); transition: all 0.3s; width: 100%; max-width: 300px; }
        .night input, .night select, .night button { background: rgba(255, 255, 255, 0.1); color: #fff; }
        input[type="date"] { max-width: 180px; }
        input:focus, select:focus { outline: none; border-color: #4a90e2; }
        button { background: #4a90e2; color: white; cursor: pointer; font-weight: 500; white-space: nowrap; }
        button:hover { background: #357abd; transform: translateY(-2px); }
        .earthquake-list { max-height: 400px; overflow-y: auto; overflow-x: hidden; }
        .earthquake-item { padding: 12px; margin: 8px 0; background: rgba(0, 0, 0, 0.05); border-radius: 10px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s; gap: 10px; }
        .night .earthquake-item { background: rgba(255, 255, 255, 0.05); }
        .earthquake-item:hover { transform: translateX(3px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .magnitude { font-size: 1.3em; font-weight: bold; color: #ff6b6b; min-width: 45px; }
        .earthquake-location { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-size: 0.9em; word-break: break-word; }
        .earthquake-time { font-size: 0.8em; opacity: 0.8; white-space: nowrap; }
        .live-indicator { display: inline-flex; align-items: center; gap: 5px; background: #ff4444; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8em; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .aurora-meter { width: 100%; height: 30px; background: linear-gradient(to right, #2ecc71 0%, #f1c40f 50%, #e74c3c 100%); border-radius: 15px; position: relative; margin: 20px 0; }
        .aurora-indicator { position: absolute; top: -5px; width: 40px; height: 40px; background: white; border-radius: 50%; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); display: flex; align-items: center; justify-content: center; font-weight: bold; transition: left 0.5s; }
        .aurora-forecast-table { width: 100%; margin-top: 15px; border-collapse: collapse; font-size: 0.9em; }
        .aurora-forecast-table th, .aurora-forecast-table td { padding: 8px; text-align: center; border: 1px solid rgba(0, 0, 0, 0.1); }
        .night .aurora-forecast-table th, .night .aurora-forecast-table td { border-color: rgba(255, 255, 255, 0.1); }
        .aurora-forecast-table th { background: rgba(0, 0, 0, 0.05); }
        .night .aurora-forecast-table th { background: rgba(255, 255, 255, 0.05); }
        .countdown-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 15px; }
        .countdown-item { text-align: center; padding: 15px; background: rgba(0, 0, 0, 0.05); border-radius: 10px; }
        .night .countdown-item { background: rgba(255, 255, 255, 0.05); }
        .countdown-number { font-size: 2em; font-weight: 300; color: #4a90e2; }
        .night .countdown-number { color: #87ceeb; }
        #radar-map { height: 300px; width: 100%; border-radius: 15px; overflow: hidden; }
        .tooltip { position: absolute; background: rgba(0, 0, 0, 0.8); color: white; padding: 10px 14px; border-radius: 6px; font-size: 0.95em; pointer-events: none; z-index: 1000; display: none; max-width: 250px; }
        .weather-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px; margin-top: 15px; }
        .weather-detail-item { display: flex; justify-content: space-between; padding: 6px 10px; background: rgba(0, 0, 0, 0.05); border-radius: 6px; font-size: 0.9em; align-items: center; }
        .night .weather-detail-item { background: rgba(255, 255, 255, 0.05); }
        .weather-detail-label { display: flex; align-items: center; gap: 5px; }
        .weather-detail-value { font-weight: 500; }
        .nameday-info { padding: 10px; background: rgba(0, 0, 0, 0.05); border-radius: 8px; margin-top: 10px; font-size: 0.9em; line-height: 1.4; max-height: 200px; overflow-y: auto; }
        .night .nameday-info { background: rgba(255, 255, 255, 0.05); }
        #namedaySearchResult div { padding: 4px 0; }
        .notable-days { margin-top: 10px; font-size: 0.9em; line-height: 1.5; }
        .notable-day-item { padding: 5px 0; border-bottom: 1px solid rgba(0, 0, 0, 0.1); }
        .night .notable-day-item { border-color: rgba(255, 255, 255, 0.1); }
        .notable-days-controls { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
        .special-holidays-search { margin-top: 15px; }
        .search-results { margin-top: 10px; max-height: 300px; overflow-y: auto; }
        .search-result-item { padding: 10px; margin: 5px 0; background: rgba(0, 0, 0, 0.05); border-radius: 8px; border-left: 4px solid #4a90e2; }
        .night .search-result-item { background: rgba(255, 255, 255, 0.05); }
        .holiday-match { background: rgba(74, 144, 226, 0.1); border: 1px solid #4a90e2; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .holiday-match p { word-break: break-word; }
        .holiday-match-title { font-weight: bold; color: #357abd; display: block; margin-bottom: 5px; }
        .night .holiday-match-title { color: #87ceeb; }
        .source-link { text-align: right; margin-top: 10px; font-size: 0.85em; }
        .source-link a { color: #4a90e2; text-decoration: none; }
        .source-link a:hover { text-decoration: underline; }
        .sun-scale { width: 100%; height: 60px; border-radius: 30px; overflow: hidden; position: relative; margin: 20px 0; background: linear-gradient(to right, #1a1a2e 0%, #1a1a2e 100%); }
        .sun-position { position: absolute; top: 50%; transform: translate(-50%, -50%); font-size: 24px; transition: left 0.5s; z-index: 3; }
        .sun-scale-markers { position: absolute; width: 100%; height: 100%; top: 0; }
        .time-marker { position: absolute; width: 2px; height: 100%; top: 0; transform: translateX(-50%); }
        .sunrise-marker, .sunset-marker { background: rgba(255, 255, 255, 0.8); }
        .noon-marker { background: rgba(255, 100, 100, 0.6); width: 1px; }
        .sun-scale-labels { display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8em; }
        .visually-hidden { position:absolute; width:1px; height:1px; margin:-1px; padding:0; overflow:hidden; clip:rect(0,0,0,0); border:0; }
        @media (min-width: 768px) {
            body { padding: 20px; } .location-bar { padding: 15px 25px; } .main-info { padding: 30px; } .current-day { font-size: 2.5em; }
            .stat-value { font-size: 2em; } .main-section { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
            .info-card { padding: 25px; } .info-card h3 { font-size: 1.2em; } .calendar-day { min-height: 60px; }
            #radar-map { height: 400px; } input, select, button { font-size: 16px; }
        }
        @media (max-width: 767px) {
            .location-bar { justify-content: center; } .location-bar > * { flex: 1 1 100%; text-align: center; }
            .day-stats { gap: 10px; } .world-clock-grid { grid-template-columns: repeat(2, 1fr); }
            .calendar-grid { font-size: 0.7em; } .notable-days-controls { flex-direction: column; align-items: stretch; }
            .notable-days-controls > * { max-width: 100%; }
        }
    </style>
</head>
<body>
    <header class="location-bar">
        <i class="fas fa-map-marker-alt"></i><span id="currentLocation">Bet√∂lt√©s...</span>
        <input type="text" id="locationInput" placeholder="√öj helysz√≠n..."><button onclick="updateLocation()" aria-label="Helysz√≠n friss√≠t√©se"><i class="fas fa-search"></i> Friss√≠t</button>
        <button onclick="getCurrentLocation()" aria-label="Saj√°t helyzet meghat√°roz√°sa"><i class="fas fa-location-crosshairs"></i> Saj√°t helyzet</button>
    </header>
    <div class="container">
        <div class="weather-alert" id="weatherAlert"><i class="fas fa-exclamation-triangle"></i> <span id="alertText"></span></div>
        <section class="main-info" aria-labelledby="main-info-heading">
            <h1 id="main-info-heading" class="visually-hidden">Aktu√°lis D√°tum √©s Id≈ë Inform√°ci√≥k</h1>
            <div class="current-day" id="currentDayInfo"></div>
            <div class="main-clock" id="mainClock" style="font-size: 3em; font-weight: 200; margin: 10px 0;"></div>
            <div id="mainTimezone" style="font-size: 0.5em; color: #888; margin-top: -15px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;"></div>
            <div class="day-stats">
                <div class="stat-item"><div class="stat-value" id="dayOfYear"></div><div class="stat-label">nap az √©vb≈ël</div></div>
                <div class="stat-item"><div class="stat-value" id="daysRemaining"></div><div class="stat-label">nap van h√°tra</div></div>
                <div class="stat-item"><div class="stat-value" id="weekNumber"></div><div class="stat-label">h√©t</div></div>
                <div class="stat-item"><div class="stat-value" id="timeZoneType"></div><div class="stat-label">id≈ësz√°m√≠t√°s<div class="timezone-details" id="timezoneDetails"></div></div></div>
            </div>
        </section>
        <main class="main-section">
            <article class="info-card">
                <h3><i class="fas fa-cloud-sun"></i> Id≈ëj√°r√°s <span class="live-indicator"><i class="fas fa-circle"></i> √âL≈ê</span></h3>
                <div id="weatherLoading" style="text-align: center;"><i class="fas fa-spinner fa-spin" style="font-size: 2em;"></i><p>Id≈ëj√°r√°s bet√∂lt√©se...</p></div>
                <div id="weatherContent" style="display: none;">
                    <div style="text-align: center;">
                        <div class="weather-icon" id="currentWeatherIcon"></div><div style="font-size: 2em; margin: 10px 0;" id="currentTemp"></div>
                        <div id="currentCondition"></div><div id="feelsLike" style="margin-top: 10px;"></div>
                    </div>
                    <div class="weather-details" id="weatherDetails"></div>
                    <div style="margin-top: 20px;"><h4>3 napos el≈ërejelz√©s</h4><div id="forecast" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;"></div></div>
                </div>
            </article>
            <section class="info-card">
                <h3><i class="fas fa-gift"></i> N√©vnapok</h3>
                <p><strong>Ma:</strong> <span id="todayNameday">Bet√∂lt√©s...</span></p><p style="margin-bottom: 15px;"><strong>Holnap:</strong> <span id="tomorrowNameday">Bet√∂lt√©s...</span></p>
                <div id="namedayInfo"></div><input type="search" id="namedaySearch" placeholder="Keress n√©vnapra..." style="width: 100%; margin-top: 15px;"><div id="namedaySearchResult" style="margin-top: 10px;"></div>
            </section>
            <section class="info-card">
                <h3><i class="fas fa-calendar-check"></i> Jeles napok √©s Vil√°gnapok</h3>
                <div class="notable-days-controls">
                    <button onclick="changeNotableDay(-1)" aria-label="El≈ëz≈ë nap"><i class="fas fa-chevron-left"></i></button>
                    <input type="date" id="notableDatePicker" onchange="goToNotableDate()" aria-label="D√°tumv√°laszt√≥ jeles napokhoz"><button onclick="goToNotableToday()">Mai nap</button>
                    <button onclick="changeNotableDay(1)" aria-label="K√∂vetkez≈ë nap"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div id="currentDayHolidays" style="margin-bottom: 15px;"></div>
                <div class="special-holidays-search"><input type="search" id="specialHolidaySearch" placeholder="Keress jeles napra..." style="width: 100%;"><div id="specialHolidayResults" class="search-results"></div></div>
                <div class="source-link" style="margin-top: auto; padding-top: 15px;">Forr√°s: Ny√≠lt adatb√°zisok</div>
            </section>
            <article class="info-card">
                <h3><i class="fas fa-history"></i> √âvfordul√≥k <span id="anniversaryCountry" style="font-size: 0.8em; opacity: 0.7;"></span></h3>
                <div id="anniversaryContent" style="max-height: 400px; overflow-y: auto; flex-grow: 1;"><div style="text-align: center;"><i class="fas fa-spinner fa-spin"></i> Bet√∂lt√©s...</div></div>
                <div class="source-link" style="margin-top: auto; padding-top: 15px;"><a href="#" id="anniversaryWikiLink" target="_blank" rel="noopener noreferrer"><i class="fab fa-wikipedia-w"></i> Forr√°s: Wikip√©dia</a></div>
            </article>
            <section class="info-card">
                <h3><i class="fas fa-calendar"></i> Havi napt√°r</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h4 id="calendarMonthYear"></h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <select id="countrySelect" aria-label="Orsz√°gv√°laszt√°s"></select>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="changeMonth(-1)" aria-label="El≈ëz≈ë h√≥nap"><i class="fas fa-chevron-left"></i></button>
                            <button onclick="goToToday()">Mai nap</button><button onclick="changeMonth(1)" aria-label="K√∂vetkez≈ë h√≥nap"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div><div id="longWeekends" style="margin-top: 20px;"></div>
            </section>
            <article class="info-card">
                <h3><i class="fas fa-moon"></i> Holdf√°zis</h3>
                <div class="moon-visual" id="moonVisual">
                    <div class="moon-phase-overlay" id="moonPhaseOverlay"></div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <div style="font-size: 1.2em; font-weight: 500;" id="moonPhaseName"></div>
                    <div id="moonPhasePercent" style="margin-top: 10px;"></div>
                    <div style="margin-top: 5px;"><i class="fas fa-moon"></i> Hold: <span id="moonZodiac"></span></div>
                    <div style="margin-top: 5px;"><i class="fas fa-sun"></i> Nap: <span id="sunZodiac"></span></div>
                    <div id="moonLocationNote" style="margin-top: 10px; font-size: 0.85em; opacity: 0.7;"></div>
                </div>
            </article>
            <article class="info-card">
                <h3><i class="fas fa-sun"></i> Nap √©s Hold</h3>
                <div class="sun-scale" id="sunScale"><div class="sun-scale-markers" id="sunScaleMarkers"></div><div class="sun-position" id="sunPosition">‚òÄÔ∏è</div></div>
                <div class="sun-scale-labels"><span id="sunriseTime">--:--</span><span>D√©l</span><span id="sunsetTime">--:--</span></div>
                <div id="sunMoonTimes" style="margin-top: 20px;"><div style="text-align: center;"><i class="fas fa-spinner fa-spin"></i> Adatok bet√∂lt√©se...</div></div>
            </article>
            <section class="info-card">
                <h3><i class="fas fa-cloud-rain"></i> Csapad√©k radar</h3>
                <div id="radarControls" style="text-align: center; margin-bottom: 10px;"><button id="playRadar" onclick="toggleRadarAnimation()" aria-label="Radar anim√°ci√≥"><i class="fas fa-play"></i> Lej√°tsz√°s</button></div>
                <div id="radar-map"></div><div id="radarTime" style="text-align: center; margin-top: 10px; font-weight: bold;"></div>
            </section>
            <section class="info-card">
                <h3><i class="fas fa-globe"></i> Vil√°gid≈ëk</h3>
                <div class="world-clock-grid">
                    <div class="time-zone-card"><strong>Los Angeles</strong><div id="timeLosAngeles"></div></div><div class="time-zone-card"><strong>New York</strong><div id="timeNewYork"></div></div>
                    <div class="time-zone-card"><strong>London</strong><div id="timeLondon"></div></div><div class="time-zone-card"><strong>Moszkva</strong><div id="timeMoscow"></div></div>
                    <div class="time-zone-card"><strong>Dubai</strong><div id="timeDubai"></div></div><div class="time-zone-card"><strong>Hong Kong</strong><div id="timeHongKong"></div></div>
                    <div class="time-zone-card"><strong>Tokyo</strong><div id="timeTokyo"></div></div><div class="time-zone-card"><strong>Sydney</strong><div id="timeSydney"></div></div>
                </div>
            </section>
            <article class="info-card">
                <h3><i class="fas fa-globe-americas"></i> F√∂ldreng√©sek <span class="live-indicator"><i class="fas fa-circle"></i> √âL≈ê</span></h3>
                <div id="earthquakeTimer" style="text-align: center; font-size: 1.2em; margin-bottom: 15px; font-weight: bold;"></div>
                <div class="earthquake-list" id="earthquakeList"><div style="text-align: center;"><i class="fas fa-spinner fa-spin"></i> Bet√∂lt√©s...</div></div>
            </article>
            <article class="info-card">
                <h3><i class="fas fa-star"></i> √âszaki f√©ny el≈ërejelz√©s</h3>
                <div class="aurora-meter"><div class="aurora-indicator" id="auroraIndicator"><span id="kpValue">0</span></div></div>
                <div style="text-align: center; margin-top: 10px;"><strong>KP Index: <span id="kpIndex">0</span>/9</strong><div id="auroraLocation" style="margin-top: 5px; font-size: 0.9em;"></div><div id="auroraVisibility" style="margin-top: 10px;"></div></div>
                <table class="aurora-forecast-table"><thead><tr><th>Id≈ëpont</th><th>KP Index</th><th>L√°that√≥s√°g</th></tr></thead><tbody id="auroraForecastTable"><tr><td colspan="3">Bet√∂lt√©s...</td></tr></tbody></table>
            </article>
            <section class="info-card">
                <h3><i class="fas fa-hourglass-half"></i> Visszasz√°ml√°l√°s</h3>
                <div class="countdown-grid">
                    <div class="countdown-item"><div class="countdown-number" id="daysToEaster"></div><div>nap H√∫sv√©tig</div></div>
                    <div class="countdown-item"><div class="countdown-number" id="daysToChristmas"></div><div>nap Kar√°csonyig</div></div>
                    <div class="countdown-item"><div class="countdown-number" id="daysToNewYear"></div><div>nap √öj√©vig</div></div>
                    <div class="countdown-item"><div class="countdown-number" id="daysToDST"></div><div id="dstLabel"></div></div>
                    <div class="countdown-item"><div class="countdown-number" id="daysToNextSeason"></div><div id="nextSeasonLabel"></div></div>
                </div>
            </section>
        </main>
    </div>
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // Glob√°lis v√°ltoz√≥k
        let userLat = 47.4979, userLon = 19.0402, userLocation = "Budapest", userCountry = "HU";
        let currentCalendarDate = new Date();
        let selectedCountry = 'HU';
        let radarMap = null, radarLayers = [], radarAnimationTimer = null, radarAnimationPosition = 0, isRadarPlaying = false;
        let earthquakeUpdateTimer = null, mostRecentEarthquakeTime = null;
        let weatherData = null;
        let holidaysCache = {}, longWeekendsCache = {};
        let availableCountries = [];
        let currentLocationMarker = null;
        let currentNotableDate = new Date();
        // JAV√çTVA: A hi√°nyz√≥ v√°ltoz√≥ deklar√°l√°sa
        let sunUpdateInterval = null;

        const extendedCountries = [ { countryCode: 'HU', name: 'Magyarorsz√°g' }, { countryCode: 'AD', name: 'Andorra' }, { countryCode: 'AE', name: 'Egyes√ºlt Arab Em√≠rs√©gek' }, { countryCode: 'AF', name: 'Afganiszt√°n' }, { countryCode: 'AG', name: 'Antigua √©s Barbuda' }, { countryCode: 'AI', name: 'Anguilla' }, { countryCode: 'AL', name: 'Alb√°nia' }, { countryCode: 'AM', name: '√ñrm√©nyorsz√°g' }, { countryCode: 'AO', name: 'Angola' }, { countryCode: 'AQ', name: 'Antarktisz' }, { countryCode: 'AR', name: 'Argent√≠na' }, { countryCode: 'AS', name: 'Amerikai Szamoa' }, { countryCode: 'AT', name: 'Ausztria' }, { countryCode: 'AU', name: 'Ausztr√°lia' }, { countryCode: 'AW', name: 'Aruba' }, { countryCode: 'AX', name: '√Öland-szigetek' }, { countryCode: 'AZ', name: 'Azerbajdzs√°n' }, { countryCode: 'BA', name: 'Bosznia-Hercegovina' }, { countryCode: 'BB', name: 'Barbados' }, { countryCode: 'BD', name: 'Banglades' }, { countryCode: 'BE', name: 'Belgium' }, { countryCode: 'BF', name: 'Burkina Faso' }, { countryCode: 'BG', name: 'Bulg√°ria' }, { countryCode: 'BH', name: 'Bahrein' }, { countryCode: 'BI', name: 'Burundi' }, { countryCode: 'BJ', name: 'Benin' }, { countryCode: 'BL', name: 'Saint-Barth√©lemy' }, { countryCode: 'BM', name: 'Bermuda' }, { countryCode: 'BN', name: 'Brunei' }, { countryCode: 'BO', name: 'Bol√≠via' }, { countryCode: 'BR', name: 'Braz√≠lia' }, { countryCode: 'BS', name: 'Bahama-szigetek' }, { countryCode: 'BT', name: 'Bhut√°n' }, { countryCode: 'BW', name: 'Botswana' }, { countryCode: 'BY', name: 'Belarusz' }, { countryCode: 'BZ', name: 'Belize' }, { countryCode: 'CA', name: 'Kanada' }, { countryCode: 'CD', name: 'Kong√≥i Demokratikus K√∂zt√°rsas√°g' }, { countryCode: 'CF', name: 'K√∂z√©p-afrikai K√∂zt√°rsas√°g' }, { countryCode: 'CG', name: 'Kong√≥' }, { countryCode: 'CH', name: 'Sv√°jc' }, { countryCode: 'CI', name: 'Elef√°ntcsontpart' }, { countryCode: 'CL', name: 'Chile' }, { countryCode: 'CM', name: 'Kamerun' }, { countryCode: 'CN', name: 'K√≠na' }, { countryCode: 'CO', name: 'Kolumbia' }, { countryCode: 'CR', name: 'Costa Rica' }, { countryCode: 'CU', name: 'Kuba' }, { countryCode: 'CV', name: 'Z√∂ld-foki K√∂zt√°rsas√°g' }, { countryCode: 'CW', name: 'Cura√ßao' }, { countryCode: 'CY', name: 'Ciprus' }, { countryCode: 'CZ', name: 'Csehorsz√°g' }, { countryCode: 'DE', name: 'N√©metorsz√°g' }, { countryCode: 'DK', name: 'D√°nia' }, { countryCode: 'DO', name: 'Dominikai K√∂zt√°rsas√°g' }, { countryCode: 'DZ', name: 'Alg√©ria' }, { countryCode: 'EC', name: 'Ecuador' }, { countryCode: 'EE', name: '√âsztorsz√°g' }, { countryCode: 'EG', name: 'Egyiptom' }, { countryCode: 'ES', name: 'Spanyolorsz√°g' }, { countryCode: 'ET', name: 'Eti√≥pia' }, { countryCode: 'FI', name: 'Finnorsz√°g' }, { countryCode: 'FR', name: 'Franciaorsz√°g' }, { countryCode: 'GA', name: 'Gabon' }, { countryCode: 'GB', name: 'Egyes√ºlt Kir√°lys√°g' }, { countryCode: 'GE', name: 'Gr√∫zia' }, { countryCode: 'GH', name: 'Gh√°na' }, { countryCode: 'GR', name: 'G√∂r√∂gorsz√°g' }, { countryCode: 'GT', name: 'Guatemala' }, { countryCode: 'HK', name: 'Hongkong' }, { countryCode: 'HN', name: 'Honduras' }, { countryCode: 'HR', name: 'Horv√°torsz√°g' }, { countryCode: 'HT', name: 'Haiti' }, { countryCode: 'ID', name: 'Indon√©zia' }, { countryCode: 'IE', name: '√çrorsz√°g' }, { countryCode: 'IL', name: 'Izrael' }, { countryCode: 'IN', name: 'India' }, { countryCode: 'IQ', name: 'Irak' }, { countryCode: 'IR', name: 'Ir√°n' }, { countryCode: 'IS', name: 'Izland' }, { countryCode: 'IT', name: 'Olaszorsz√°g' }, { countryCode: 'JM', name: 'Jamaica' }, { countryCode: 'JO', name: 'Jord√°nia' }, { countryCode: 'JP', name: 'Jap√°n' }, { countryCode: 'KE', name: 'Kenya' }, { countryCode: 'KG', name: 'Kirgiziszt√°n' }, { countryCode: 'KH', name: 'Kambodzsa' }, { countryCode: 'KR', name: 'D√©l-Korea' }, { countryCode: 'KW', name: 'Kuvait' }, { countryCode: 'KZ', name: 'Kazahszt√°n' }, { countryCode: 'LA', name: 'Laosz' }, { countryCode: 'LB', name: 'Libanon' }, { countryCode: 'LI', name: 'Liechtenstein' }, { countryCode: 'LK', name: 'Sr√≠ Lanka' }, { countryCode: 'LR', name: 'Lib√©ria' }, { countryCode: 'LS', name: 'Lesotho' }, { countryCode: 'LT', name: 'Litv√°nia' }, { countryCode: 'LU', name: 'Luxemburg' }, { countryCode: 'LV', name: 'Lettorsz√°g' }, { countryCode: 'LY', name: 'L√≠bia' }, { countryCode: 'MA', name: 'Marokk√≥' }, { countryCode: 'MC', name: 'Monaco' }, { countryCode: 'MD', name: 'Moldova' }, { countryCode: 'ME', name: 'Montenegr√≥' }, { countryCode: 'MG', name: 'Madagaszk√°r' }, { countryCode: 'MK', name: '√âszak-Maced√≥nia' }, { countryCode: 'ML', name: 'Mali' }, { countryCode: 'MM', name: 'Mianmar' }, { countryCode: 'MN', name: 'Mong√≥lia' }, { countryCode: 'MT', name: 'M√°lta' }, { countryCode: 'MU', name: 'Mauritius' }, { countryCode: 'MV', name: 'Mald√≠v-szigetek' }, { countryCode: 'MW', name: 'Malawi' }, { countryCode: 'MX', name: 'Mexik√≥' }, { countryCode: 'MY', name: 'Malajzia' }, { countryCode: 'MZ', name: 'Mozambik' }, { countryCode: 'NA', name: 'Nam√≠bia' }, { countryCode: 'NE', name: 'Niger' }, { countryCode: 'NG', name: 'Nig√©ria' }, { countryCode: 'NI', name: 'Nicaragua' }, { countryCode: 'NL', name: 'Hollandia' }, { countryCode: 'NO', name: 'Norv√©gia' }, { countryCode: 'NP', name: 'Nep√°l' }, { countryCode: 'NZ', name: '√öj-Z√©land' }, { countryCode: 'PA', name: 'Panama' }, { countryCode: 'PE', name: 'Peru' }, { countryCode: 'PG', name: 'P√°pua √öj-Guinea' }, { countryCode: 'PH', name: 'F√ºl√∂p-szigetek' }, { countryCode: 'PK', name: 'Pakiszt√°n' }, { countryCode: 'PL', name: 'Lengyelorsz√°g' }, { countryCode: 'PR', name: 'Puerto Rico' }, { countryCode: 'PS', name: 'Palesztina' }, { countryCode: 'PT', name: 'Portug√°lia' }, { countryCode: 'PY', name: 'Paraguay' }, { countryCode: 'QA', name: 'Katar' }, { countryCode: 'RO', name: 'Rom√°nia' }, { countryCode: 'RS', name: 'Szerbia' }, { countryCode: 'RU', 'name': 'Oroszorsz√°g' }, { countryCode: 'RW', name: 'Ruanda' }, { countryCode: 'SA', name: 'Sza√∫d-Ar√°bia' }, { countryCode: 'SC', name: 'Seychelle-szigetek' }, { countryCode: 'SD', name: 'Szud√°n' }, { countryCode: 'SE', name: 'Sv√©dorsz√°g' }, { countryCode: 'SG', name: 'Szingap√∫r' }, { countryCode: 'SI', name: 'Szlov√©nia' }, { countryCode: 'SK', name: 'Szlov√°kia' }, { countryCode: 'SL', name: 'Sierra Leone' }, { countryCode: 'SM', name: 'San Marino' }, { countryCode: 'SN', name: 'Szeneg√°l' }, { countryCode: 'SO', name: 'Szom√°lia' }, { countryCode: 'SR', name: 'Suriname' }, { countryCode: 'SS', name: 'D√©l-Szud√°n' }, { countryCode: 'SV', name: 'Salvador' }, { countryCode: 'SY', name: 'Sz√≠ria' }, { countryCode: 'SZ', name: 'Szv√°zif√∂ld' }, { countryCode: 'TD', name: 'Cs√°d' }, { countryCode: 'TG', name: 'Togo' }, { countryCode: 'TH', name: 'Thaif√∂ld' }, { countryCode: 'TJ', name: 'T√°dzsikiszt√°n' }, { countryCode: 'TM', name: 'T√ºrkmeniszt√°n' }, { countryCode: 'TN', name: 'Tun√©zia' }, { countryCode: 'TO', name: 'Tonga' }, { countryCode: 'TR', name: 'T√∂r√∂korsz√°g' }, { countryCode: 'TT', name: 'Trinidad √©s Tobago' }, { countryCode: 'TW', name: 'Tajvan' }, { countryCode: 'TZ', name: 'Tanz√°nia' }, { countryCode: 'UA', name: 'Ukrajna' }, { countryCode: 'UG', name: 'Uganda' }, { countryCode: 'US', name: 'Egyes√ºlt √Ållamok' }, { countryCode: 'UY', name: 'Uruguay' }, { countryCode: 'UZ', name: '√úzbegiszt√°n' }, { countryCode: 'VA', name: 'Vatik√°n' }, { countryCode: 'VE', name: 'Venezuela' }, { countryCode: 'VN', name: 'Vietn√°m' }, { countryCode: 'YE', name: 'Jemen' }, { countryCode: 'ZA', name: 'D√©l-Afrika' }, { countryCode: 'ZM', name: 'Zambia' }, { countryCode: 'ZW', name: 'Zimbabwe' }];
        const specialHolidays = { 'a magyar kult√∫ra napja': { date: '01-22', description: 'A Himnusz befejez√©s√©nek √©vfordul√≥ja.' }, 'a holokauszt nemzetk√∂zi eml√©knapja': { date: '01-27', description: 'Az auschwitzi koncentr√°ci√≥s t√°bor felszabad√≠t√°s√°nak napja.' }, 'a vizes √©l≈ëhelyek vil√°gnapja': { date: '02-02', description: 'A R√°mszari Egyezm√©ny al√°√≠r√°s√°nak napja.' }, 'a r√°kellenes vil√°gnap': { date: '02-04', description: 'Nemzetk√∂zi nap a r√°kbetegs√©g elleni k√ºzdelem√©rt.' }, 'az anyanyelv nemzetk√∂zi napja': { date: '02-21', description: 'Az UNESCO √°ltal a nyelvi soksz√≠n≈±s√©g√©rt l√©trehozott nap.' }, 'a kommunista diktat√∫r√°k √°ldozatainak eml√©knapja': { date: '02-25', description: 'Kov√°cs B√©la, kisgazda politikus elhurcol√°s√°nak napja.' }, 'nemzetk√∂zi n≈ënap': { date: '03-08', description: 'A n≈ëk jogai √©s a nemzetk√∂zi b√©ke napja.' },'a v√≠z vil√°gnapja': { date: '03-22', description: 'Az ENSZ √°ltal a tiszta v√≠z fontoss√°g√°ra f√≥kusz√°l√≥ nap.' },'sz√≠nh√°zi vil√°gnap': { date: '03-27', description: 'Nemzetk√∂zi nap a sz√≠nh√°zm≈±v√©szet √ºnnepl√©s√©re.' }, 'az autizmus vil√°gnapja': { date: '04-02', description: 'Az ENSZ √°ltal az autizmussal √©l≈ëk helyzet√©re f√≥kusz√°l√≥ nap.' }, 'eg√©szs√©g√ºgyi vil√°gnap': { date: '04-07', description: 'A WHO alap√≠t√°s√°nak √©vfordul√≥ja.' }, 'a magyar k√∂lt√©szet napja': { date: '04-11', description: 'J√≥zsef Attila sz√ºlet√©snapja.' }, 'a holokauszt magyarorsz√°gi √°ldozatainak eml√©knapja': { date: '04-16', description: 'A budapesti gett√≥ fel√°ll√≠t√°s√°nak √©vfordul√≥ja.' }, 'a f√∂ld napja': { date: '04-22', description: 'Vil√°gm√©ret≈± k√∂rnyezetv√©delmi mozgalom napja.' }, 'a t√°nc vil√°gnapja': { date: '04-29', description: 'Jean-Georges Noverre, a klasszikus balett meg√∫j√≠t√≥j√°nak sz√ºlet√©snapja.' }, 'a sajt√≥szabads√°g vil√°gnapja': { date: '05-03', description: 'Az UNESCO √°ltal a sajt√≥szabads√°g fontoss√°g√°ra f√≥kusz√°l√≥ nap.' }, 'madarak √©s f√°k napja': { date: '05-10', description: 'Herman Ott√≥ kezdem√©nyez√©s√©re indult term√©szetv√©delmi nap.' }, 'a nemzetk√∂zi csal√°dnap': { date: '05-15', description: 'Az ENSZ √°ltal a csal√°dok fontoss√°g√°ra f√≥kusz√°l√≥ nap.' }, 'a nemzeti √∂sszetartoz√°s napja': { date: '06-04', description: 'A trianoni b√©keszerz≈ëd√©s al√°√≠r√°s√°nak √©vfordul√≥ja.' }, 'k√∂rnyezetv√©delmi vil√°gnap': { date: '06-05', description: 'Az ENSZ √°ltal a k√∂rnyezetv√©delem√©rt ind√≠tott nap.' }, 'a menek√ºltek vil√°gnapja': { date: '06-20', description: 'Az ENSZ √°ltal a menek√ºltek helyzet√©re f√≥kusz√°l√≥ nap.' }, 'a zene √ºnnepe': { date: '06-21', description: 'Nemzetk√∂zi nap, ahol a zen√©t √©s zen√©szeket √ºnneplik.' }, 'a magyar eg√©szs√©g√ºgy napja': { date: '07-01', description: 'Semmelweis Ign√°c sz√ºlet√©snapja.' }, 'a bar√°ts√°g vil√°gnapja': { date: '07-30', description: 'Nemzetk√∂zi nap a bar√°ts√°g √ºnnepl√©s√©re.' }, 'a roma holokauszt eml√©knapja': { date: '08-02', description: 'Az auschwitzi cig√°ny l√°ger felsz√°mol√°s√°nak eml√©knapja.' }, 'az √°llatkertek napja': { date: '08-09', description: 'A budapesti √°llatkert megnyit√°s√°nak √©vfordul√≥ja.' }, 'az ifj√∫s√°g nemzetk√∂zi napja': { date: '08-12', description: 'Az ENSZ √°ltal a fiatalok szerep√©re f√≥kusz√°l√≥ nap.' }, 'az eur√≥pai eml√©knap': { date: '08-23', description: 'A totalit√°rius diktat√∫r√°k √°ldozatainak eur√≥pai eml√©knapja.' },'a b√©ke nemzetk√∂zi napja': { date: '09-21', description: 'Az ENSZ √°ltal a glob√°lis fegyversz√ºnetre √©s er≈ëszakmentess√©gre felh√≠v√≥ nap.' },'a magyar dr√°ma napja': { date: '09-21', description: 'Mad√°ch Imre "Az ember trag√©di√°ja" c. m≈±v√©nek ≈ësbemutat√≥ja.' },'turizmus vil√°gnapja': { date: '09-27', description: 'A turizmus kultur√°lis √©s gazdas√°gi jelent≈ës√©g√©t √ºnnepl≈ë nap.' },'a zene vil√°gnapja': { date: '10-01', description: 'Yehudi Menuhin kezdem√©nyez√©s√©re indult nemzetk√∂zi √ºnnep.' },'az √°llatok vil√°gnapja': { date: '10-04', description: 'Assisi Szent Ferenc, az √°llatok v√©d≈ëszentj√©nek eml√©knapja.' },'az aradi v√©rtan√∫k eml√©knapja': { date: '10-06', description: 'Nemzeti gy√°sznap.' },'a l√°t√°s vil√°gnapja': { date: '10-10', description: 'A vaks√°g √©s a l√°t√°sroml√°s megel≈ëz√©s√©re h√≠vja fel a figyelmet.' },'az √©lelmez√©si vil√°gnap': { date: '10-16', description: 'A FAO alap√≠t√°s√°nak napja, az √©hez√©s elleni k√ºzdelem√©rt.' },'a magyar z√°szl√≥ √©s c√≠mer napja': { date: '10-23', description: 'Az 1956-os forradalom √©s szabads√°gharc eml√©knapja.' },'a magyar tudom√°ny √ºnnepe': { date: '11-03', description: 'Sz√©chenyi Istv√°n √°ltal a Tudom√°nyos Akad√©mia alap√≠t√°s√°nak napja.' },'a magyar nyelv napja': { date: '11-13', description: 'Az 1844-es orsz√°ggy≈±l√©sen a magyar nyelv hivataloss√° t√©tel√©nek napja.' },'az emberi jogok napja': { date: '12-10', description: 'Az Emberi Jogok Egyetemes Nyilatkozat√°nak elfogad√°s√°nak napja.' }, 'any√°k napja': { description: 'Any√°k napja - m√°jus els≈ë vas√°rnapj√°n √ºnnepelj√ºk', calculateDate: (year) => { const d = new Date(year, 4, 1); d.setDate(1 + (7 - d.getDay() + 7) % 7); return d; } }, 'pedag√≥gusnap': { description: 'Pedag√≥gusnap - j√∫nius els≈ë vas√°rnapj√°n √ºnnepelj√ºk', calculateDate: (year) => { const d = new Date(year, 5, 1); d.setDate(1 + (7 - d.getDay() + 7) % 7); return d; } }, 'ap√°k napja': { description: 'Ap√°k napja - j√∫nius harmadik vas√°rnapj√°n √ºnnepelj√ºk', calculateDate: (year) => { const d = new Date(year, 5, 1); d.setDate(1 + (7 - d.getDay() + 7) % 7 + 14); return d; } }, 'h√∫sv√©tvas√°rnap': { description: 'H√∫sv√©tvas√°rnap - a kereszt√©nys√©g legnagyobb √ºnnepe.', calculateDate: (year) => calculateEaster(year) }, 'h√∫sv√©th√©tf≈ë': { description: 'H√∫sv√©th√©tf≈ë - H√∫sv√©t m√°sodnapja, munkasz√ºneti nap.', calculateDate: (year) => { const d = calculateEaster(year); d.setUTCDate(d.getUTCDate() + 1); return d; } }, 'p√ºnk√∂sdvas√°rnap': { description: 'P√ºnk√∂sdvas√°rnap - a Szentl√©lek elj√∂vetel√©nek √ºnnepe.', calculateDate: (year) => { const d = calculateEaster(year); d.setUTCDate(d.getUTCDate() + 49); return d; } }, 'p√ºnk√∂sdh√©tf≈ë': { description: 'P√ºnk√∂sdh√©tf≈ë - P√ºnk√∂sd m√°sodnapja, munkasz√ºneti nap.', calculateDate: (year) => { const d = calculateEaster(year); d.setUTCDate(d.getUTCDate() + 50); return d; } }, };
        const namedays = { '01-01':['Fruzsina','√öj√©v'],'01-02':['√Åbel','Gergely'],'01-03':['Genov√©va','Benj√°min'],'01-04':['Titusz','Leona'],'01-05':['Simon'],'01-06':['Boldizs√°r','V√≠zkereszt'],'01-07':['Attila','Ram√≥na'],'01-08':['Gy√∂ngyv√©r'],'01-09':['Marcell'],'01-10':['Mel√°nia'],'01-11':['√Ågota'],'01-12':['Ern≈ë'],'01-13':['Veronika'],'01-14':['B√≥dog'],'01-15':['L√≥r√°nt','Lor√°nd'],'01-16':['Guszt√°v'],'01-17':['Antal','Ant√≥nia'],'01-18':['Piroska'],'01-19':['S√°ra','M√°ri√≥'],'01-20':['F√°bi√°n','Sebesty√©n'],'01-21':['√Ågnes'],'01-22':['Vince','Art√∫r'],'01-23':['Zelma','Rajmund'],'01-24':['Tim√≥t','X√©nia'],'01-25':['P√°l'],'01-26':['Vanda','Paula'],'01-27':['Angelika'],'01-28':['K√°roly','Karola'],'01-29':['Ad√©l'],'01-30':['Gerda','Martina'],'01-31':['Marcella'],'02-01':['Ign√°c'],'02-02':['Karolina','Aida'],'02-03':['Bal√°zs'],'02-04':['R√°hel','Csenge'],'02-05':['√Ågota','Ingrid'],'02-06':['Dorottya','D√≥ra'],'02-07':['T√≥dor','R√≥me√≥'],'02-08':['Aranka'],'02-09':['Abig√©l','Alex'],'02-10':['Elvira'],'02-11':['Bertold','Marietta'],'02-12':['L√≠via','L√≠dia'],'02-13':['Ella','Linda'],'02-14':['B√°lint','Valentin'],'02-15':['Kolos','Georgina'],'02-16':['Julianna','Lilla'],'02-17':['Don√°t'],'02-18':['Bernadett'],'02-19':['Zsuzsanna'],'02-20':['Alad√°r','√Ålmos'],'02-21':['Eleon√≥ra'],'02-22':['Gerzson'],'02-23':['Alfr√©d'],'02-24':['M√°ty√°s'],'02-25':['G√©za'],'02-26':['Edina'],'02-27':['√Åkos','B√°tor'],'02-28':['Elem√©r'],'03-01':['Albin'],'03-02':['Lujza'],'03-03':['Korn√©lia'],'03-04':['K√°zm√©r'],'03-05':['Adorj√°n','Adri√°n'],'03-06':['Leon√≥ra','Inez'],'03-07':['Tam√°s'],'03-08':['Zolt√°n','N≈ënap'],'03-09':['Franciska','Fanni'],'03-10':['Ildik√≥'],'03-11':['Szil√°rd'],'03-12':['Gergely'],'03-13':['Kriszti√°n','Ajtony'],'03-14':['Matild'],'03-15':['Krist√≥f','Nemzeti √ºnnep'],'03-16':['Henrietta'],'03-17':['Gertr√∫d','Patrik'],'03-18':['S√°ndor','Ede'],'03-19':['J√≥zsef','B√°nk'],'03-20':['Klaudia'],'03-21':['Benedek'],'03-22':['Be√°ta','Izolda'],'03-23':['Em≈ëke'],'03-24':['G√°bor','Karina'],'03-25':['Ir√©n','√çrisz'],'03-26':['Em√°nuel'],'03-27':['Hajnalka'],'03-28':['Gedeon','Johanna'],'03-29':['Auguszta'],'03-30':['Zal√°n'],'03-31':['√Årp√°d'],'04-01':['Hug√≥'],'04-02':['√Åron'],'04-03':['Buda','Rich√°rd'],'04-04':['Izidor'],'04-05':['Vince'],'04-06':['Vilmos','B√≠borka'],'04-07':['Herman'],'04-08':['D√©nes'],'04-09':['Erhard'],'04-10':['Zsolt'],'04-11':['Le√≥','Szaniszl√≥'],'04-12':['Gyula'],'04-13':['Ida'],'04-14':['Tibor'],'04-15':['Anaszt√°zia','Tas'],'04-16':['Csongor'],'04-17':['Rudolf'],'04-18':['Andrea','Ilma'],'04-19':['Emma'],'04-20':['Tivadar'],'04-21':['Konr√°d'],'04-22':['Csilla','No√©mi'],'04-23':['B√©la'],'04-24':['Gy√∂rgy'],'04-25':['M√°rk'],'04-26':['Ervin'],'04-27':['Zita','Mariann'],'04-28':['Val√©ria'],'04-29':['P√©ter'],'04-30':['Katalin','Kitti'],'05-01':['F√ºl√∂p','Jakab','Munka √ºnnepe'],'05-02':['Zsigmond'],'05-03':['T√≠mea','Irma'],'05-04':['M√≥nika','Fl√≥ri√°n'],'05-05':['Gy√∂rgyi'],'05-06':['Ivett','Frida'],'05-07':['Gizella'],'05-08':['Mih√°ly'],'05-09':['Gergely'],'05-10':['√Årmin','P√°lma'],'05-11':['Ferenc'],'05-12':['Pongr√°c'],'05-13':['Szerv√°c','Imola'],'05-14':['Bonif√°c'],'05-15':['Zs√≥fia','Szonja'],'05-16':['M√≥zes','Botond'],'05-17':['Paszk√°l'],'05-18':['Erik','Alexandra'],'05-19':['Iv√≥','Mil√°n'],'05-20':['Bern√°t','Fel√≠cia'],'05-21':['Konstantin'],'05-22':['J√∫lia','Rita'],'05-23':['Dezs≈ë'],'05-24':['Eszter','Eliza'],'05-25':['Orb√°n'],'05-26':['F√ºl√∂p','Evelin'],'05-27':['Hella'],'05-28':['Emil','Csan√°d'],'05-29':['Magdolna'],'05-30':['Janka','Zsanett'],'05-31':['Ang√©la','Petronella'],'06-01':['T√ºnde','Gyermeknap'],'06-02':['K√°rmen','Anita'],'06-03':['Klotild'],'06-04':['Bulcs√∫'],'06-05':['Fatime'],'06-06':['Norbert','Cintia'],'06-07':['R√≥bert'],'06-08':['Med√°rd'],'06-09':['F√©lix'],'06-10':['Margit','Gr√©ta'],'06-11':['Barnab√°s'],'06-12':['Vill≈ë'],'06-13':['Antal','Anett'],'06-14':['Vazul'],'06-15':['Jol√°n','Vid'],'06-16':['Jusztin'],'06-17':['Laura','Alida'],'06-18':['Arnold','Levente'],'06-19':['Gy√°rf√°s'],'06-20':['Rafael'],'06-21':['Alajos','Leila'],'06-22':['Paulina'],'06-23':['Zolt√°n'],'06-24':['Iv√°n'],'06-25':['Vilmos'],'06-26':['J√°nos','P√°l'],'06-27':['L√°szl√≥'],'06-28':['Levente','Ir√©n'],'06-29':['P√©ter','P√°l'],'06-30':['P√°l'],'07-01':['Annam√°ria','Tiham√©r'],'07-02':['Ott√≥'],'07-03':['Korn√©l','Soma'],'07-04':['Ulrik'],'07-05':['Emese','Sarolta'],'07-06':['Csaba'],'07-07':['Apoll√≥nia'],'07-08':['Ell√°k'],'07-09':['Lukr√©cia'],'07-10':['Am√°lia'],'07-11':['N√≥ra','Lili'],'07-12':['Izabella','Dalma'],'07-13':['Jen≈ë'],'07-14':['√ñrs','Stella'],'07-15':['Henrik','Roland'],'07-16':['Valter'],'07-17':['Endre','Elek'],'07-18':['Frigyes'],'07-19':['Em√≠lia'],'07-20':['Ill√©s'],'07-21':['D√°niel','Daniella'],'07-22':['Magdolna'],'07-23':['Lenke'],'07-24':['Kinga','Kincs≈ë'],'07-25':['Krist√≥f','Jakab'],'07-26':['Anna','Anik√≥'],'07-27':['Olga','Lili√°na'],'07-28':['Szabolcs'],'07-29':['M√°rta','Fl√≥ra'],'07-30':['Judit','X√©nia'],'07-31':['Oszk√°r'],'08-01':['Bogl√°rka'],'08-02':['Lehel'],'08-03':['Hermina'],'08-04':['Domonkos','Dominika'],'08-05':['Krisztina'],'08-06':['Berta','Bettina'],'08-07':['Ibolya'],'08-08':['L√°szl√≥'],'08-09':['Em≈ëd'],'08-10':['L≈ërinc'],'08-11':['Zsuzsanna','Tiborc'],'08-12':['Kl√°ra'],'08-13':['Ipoly'],'08-14':['Marcell'],'08-15':['M√°ria','Nagyboldogasszony'],'08-16':['√Åbrah√°m'],'08-17':['J√°cint'],'08-18':['Ilona'],'08-19':['Huba'],'08-20':['Istv√°n','√Ållamalap√≠t√°s √ºnnepe'],'08-21':['S√°muel','Hajna'],'08-22':['Menyh√©rt','Mirjam'],'08-23':['Bence'],'08-24':['Bertalan'],'08-25':['Lajos','Patr√≠cia'],'08-26':['Izs√≥'],'08-27':['G√°sp√°r'],'08-28':['√Ågoston'],'08-29':['Beatrix','Erna'],'08-30':['R√≥zsa'],'08-31':['Erika','Bella'],'09-01':['Egyed','Egon'],'09-02':['Rebeka','Dorina'],'09-03':['Hilda'],'09-04':['Roz√°lia'],'09-05':['Viktor','L≈ërinc'],'09-06':['Zakari√°s'],'09-07':['Regina'],'09-08':['M√°ria','Adrienn'],'09-09':['√Åd√°m'],'09-10':['Nikolett','Hunor'],'09-11':['Teod√≥ra'],'09-12':['M√°ria'],'09-13':['Korn√©l'],'09-14':['Szer√©na','Rox√°na'],'09-15':['Enik≈ë','Melitta'],'09-16':['Edit'],'09-17':['Zs√≥fia'],'09-18':['Di√°na'],'09-19':['Vilhelmina'],'09-20':['Friderika'],'09-21':['M√°t√©','Mirella'],'09-22':['M√≥ric'],'09-23':['Tekla'],'09-24':['Gell√©rt','Merc√©desz'],'09-25':['Eufrozina','Kende'],'09-26':['Jusztina'],'09-27':['Adalbert'],'09-28':['Vencel'],'09-29':['Mih√°ly'],'09-30':['Jeromos'],'10-01':['Malvin'],'10-02':['Petra'],'10-03':['Helga'],'10-04':['Ferenc'],'10-05':['Aur√©l'],'10-06':['Br√∫n√≥','Ren√°ta'],'10-07':['Am√°lia'],'10-08':['Kopp√°ny'],'10-09':['D√©nes'],'10-10':['Gedeon'],'10-11':['Brigitta'],'10-12':['Miksa'],'10-13':['K√°lm√°n','Ede'],'10-14':['Hel√©n'],'10-15':['Ter√©z'],'10-16':['G√°l'],'10-17':['Hedvig'],'10-18':['Luk√°cs'],'10-19':['N√°ndor'],'10-20':['Vendel'],'10-21':['Orsolya'],'10-22':['El≈ëd'],'10-23':['Gy√∂ngyi','Nemzeti √ºnnep'],'10-24':['Salamon'],'10-25':['Blanka','Bianka'],'10-26':['D√∂m√∂t√∂r'],'10-27':['Szabina'],'10-28':['Simon','Szimonetta'],'10-29':['N√°rcisz'],'10-30':['Alfonz'],'10-31':['Farkas'],'11-01':['Marianna','Mindenszentek'],'11-02':['Achilles','Halottak napja'],'11-03':['Gy≈ëz≈ë'],'11-04':['K√°roly'],'11-05':['Imre'],'11-06':['L√©n√°rd'],'11-07':['Rezs≈ë'],'11-08':['Zsombor'],'11-09':['Tivadar'],'11-10':['R√©ka'],'11-11':['M√°rton'],'11-12':['J√≥n√°s','Ren√°t√≥'],'11-13':['Szilvia'],'11-14':['Aliz'],'11-15':['Albert','Lip√≥t'],'11-16':['√ñd√∂n'],'11-17':['Hortenzia','Gerg≈ë'],'11-18':['Jen≈ë'],'11-19':['Erzs√©bet'],'11-20':['Jol√°n'],'11-21':['Oliv√©r'],'11-22':['Cec√≠lia'],'11-23':['Kelemen','Klementina'],'11-24':['Emma'],'11-25':['Katalin'],'11-26':['Vir√°g'],'11-27':['Virgil'],'11-28':['Stef√°nia'],'11-29':['Taksony'],'11-30':['Andr√°s','Andor'],'12-01':['Elza'],'12-02':['Melinda','Vivien'],'12-03':['Ferenc','Ol√≠via'],'12-04':['Borb√°la','Barbara'],'12-05':['Vilma'],'12-06':['Mikl√≥s'],'12-07':['Ambrus'],'12-08':['M√°ria'],'12-09':['Nat√°lia'],'12-10':['Judit'],'12-11':['√Årp√°d'],'12-12':['Gabriella'],'12-13':['Luca','Ot√≠lia'],'12-14':['Szil√°rda'],'12-15':['Val√©r'],'12-16':['Etelka','Aletta'],'12-17':['L√°z√°r','Olimpia'],'12-18':['Auguszta'],'12-19':['Viola'],'12-20':['Teofil'],'12-21':['Tam√°s'],'12-22':['Z√©n√≥'],'12-23':['Vikt√≥ria'],'12-24':['√Åd√°m','√âva','Szenteste'],'12-25':['Eug√©nia','Kar√°csony'],'12-26':['Istv√°n','Kar√°csony'],'12-27':['J√°nos'],'12-28':['Kamilla'],'12-29':['Tam√°s','Tamara'],'12-30':['D√°vid'],'12-31':['Szilveszter'] };
        
        function calculateEaster(year) { const a = year % 19, b = Math.floor(year / 100), c = year % 100, d = Math.floor(b / 4), e = b % 4, f = Math.floor((b + 8) / 25), g = Math.floor((b - f + 1) / 3), h = (19 * a + b - d - g + 15) % 30, i = Math.floor(c / 4), k = c % 4, l = (32 + 2 * e + 2 * i - h - k) % 7, m = Math.floor((a + 11 * h + 22 * l) / 451), month = Math.floor((h + l - 7 * m + 114) / 31) - 1, day = ((h + l - 7 * m + 114) % 31) + 1; return new Date(Date.UTC(year, month, day)); }
        function getWeatherIcon(code, isDay) { const map = { 0: isDay ? '‚òÄÔ∏è' : 'üåô', 1: isDay ? 'üå§Ô∏è' : 'üåô', 2: '‚õÖ', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 48: 'üå´Ô∏è', 51: 'üå¶Ô∏è', 53: 'üå¶Ô∏è', 55: 'üåßÔ∏è', 56: 'üå®Ô∏è', 57: 'üå®Ô∏è', 61: 'üå¶Ô∏è', 63: 'üåßÔ∏è', 65: 'üåßÔ∏è', 66: 'üå®Ô∏è', 67: 'üå®Ô∏è', 71: 'üå®Ô∏è', 73: 'üå®Ô∏è', 75: '‚ùÑÔ∏è', 77: '‚ùÑÔ∏è', 80: 'üå¶Ô∏è', 81: 'üåßÔ∏è', 82: 'üåßÔ∏è', 85: 'üå®Ô∏è', 86: '‚ùÑÔ∏è', 95: '‚õàÔ∏è', 96: '‚õàÔ∏è', 99: '‚õàÔ∏è' }; return map[code] || '‚ùì'; }
        function getWeatherDescription(code) { const map = { 0: "Tiszta √©gbolt", 1: "T√∂bbnyire tiszta", 2: "R√©szben felh≈ës", 3: "Borult", 45: "K√∂d", 48: "Z√∫zmar√°s k√∂d", 51: "Gyenge szit√°l√°s", 53: "M√©rs√©kelt szit√°l√°s", 55: "S≈±r≈± szit√°l√°s", 56: "Gyenge fagyos szit√°l√°s", 57: "S≈±r≈± fagyos szit√°l√°s", 61: "Gyenge es≈ë", 63: "M√©rs√©kelt es≈ë", 65: "Er≈ës es≈ë", 66: "Gyenge fagyos es≈ë", 67: "Er≈ës fagyos es≈ë", 71: "Gyenge havaz√°s", 73: "M√©rs√©kelt havaz√°s", 75: "Er≈ës havaz√°s", 77: "H√≥sz√°lling√≥z√°s", 80: "Gyenge z√°porok", 81: "M√©rs√©kelt z√°porok", 82: "Heves z√°porok", 85: "Gyenge h√≥z√°porok", 86: "Er≈ës h√≥z√°porok", 95: "Zivatar", 96: "Zivatar enyhe j√©ges≈ëvel", 99: "Zivatar er≈ës j√©ges≈ëvel" }; return map[code] || "Ismeretlen"; }

        function loadCountries() { availableCountries = extendedCountries; const select = $('#countrySelect').empty(); select.append(`<option value="HU">Magyarorsz√°g</option>`); extendedCountries.filter(c => c.countryCode !== 'HU').sort((a, b) => a.name.localeCompare(b.name, 'hu')).forEach(c => { select.append(`<option value="${c.countryCode}">${c.name}</option>`); }); select.val(userCountry); }
        function getCurrentLocation() { if (navigator.geolocation) { navigator.geolocation.getCurrentPosition( pos => reverseGeocode(pos.coords.latitude, pos.coords.longitude), err => { console.log('Geolok√°ci√≥ hiba:', err); initializeAll(); }); } else { initializeAll(); } }
        function reverseGeocode(lat, lon) { userLat = lat; userLon = lon; $.ajax({ url: `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=hu`, success: function(data) { if (data && data.address) { userLocation = data.address.city || data.address.town || data.address.village || data.address.county || 'Ismeretlen hely'; userCountry = data.address.country_code ? data.address.country_code.toUpperCase() : 'HU'; if (availableCountries.find(c => c.countryCode === userCountry)) { $('#countrySelect').val(userCountry); selectedCountry = userCountry; } } initializeAll(); }, error: () => initializeAll() }); }
        function updateLocation() { const newLocation = $('#locationInput').val(); if (newLocation) { $.ajax({ url: `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(newLocation)}&limit=1&accept-language=hu`, success: data => (data && data.length > 0) ? reverseGeocode(data[0].lat, data[0].lon) : alert('Helysz√≠n nem tal√°lhat√≥.'), error: () => alert('Keres√©si hiba.') }); } }
        function updateTitle(locationName) { document.title = (locationName && locationName.toLowerCase() !== "budapest") ? `Id≈ëj√°r√°s √©s napt√°r - ${locationName} | Napt√°r Pro` : 'Napt√°r Pro - Val√≥s idej≈± adatokkal'; }
        function setDaytimeColors() { const hour = new Date().getHours(); $('body').removeClass('morning afternoon evening night').addClass(hour >= 6 && hour < 12 ? 'morning' : hour >= 12 && hour < 17 ? 'afternoon' : hour >= 17 && hour < 21 ? 'evening' : 'night'); }
        
        function updateTime() {
            const targetTimezone = weatherData ? weatherData.timezone : Intl.DateTimeFormat().resolvedOptions().timeZone;
            const now = new Date();
            const dateInTZStr = now.toLocaleString('en-CA', { timeZone: targetTimezone, year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).replace(',', '');
            const dateInTZ = new Date(dateInTZStr.replace(' ', 'T') + 'Z');
            
            $('#mainClock').text(now.toLocaleTimeString('hu-HU', { timeZone: targetTimezone }));
            $('#mainTimezone').text(targetTimezone.replace(/_/g, ' '));
            $('#currentDayInfo').html(`${dateInTZ.toLocaleDateString('hu-HU', {timeZone: 'UTC', year: 'numeric', month: 'long', day: 'numeric'})}, ${dateInTZ.toLocaleDateString('hu-HU', {timeZone: 'UTC', weekday: 'long'})}`);
            
            const startOfYear = new Date(Date.UTC(dateInTZ.getUTCFullYear(), 0, 0));
            $('#dayOfYear').text(Math.floor((dateInTZ - startOfYear) / 86400000));
            const endOfYear = new Date(Date.UTC(dateInTZ.getUTCFullYear(), 11, 31));
            $('#daysRemaining').text(Math.floor((endOfYear - dateInTZ) / 86400000) + 1);
            $('#weekNumber').text(getWeekNumber(dateInTZ) + '.');
            
            const isDST = isDaylightSavingTime(now, targetTimezone);
            const nextDST = getNextDSTChange(now, targetTimezone);
            $('#timeZoneType').text(isDST ? 'ny√°ri' : 't√©li');
            $('#timezoneDetails').text(`V√°lt√°s: ${nextDST.toLocaleDateString('hu-HU')}`);

            updateWorldClocks(now);
            updateNamedays(dateInTZ);
            updateZodiacSigns(dateInTZ);
            updateCountdowns(dateInTZ);
        }
        
function isDaylightSavingTime(date = new Date(), timeZone) {
    if (!timeZone) {
        return false;
    }
    try {
        const year = date.getFullYear();

        // Numerikus GMT eltol√°s meghat√°roz√°sa janu√°rra
        const janFullOffset = new Date(Date.UTC(year, 0, 1)).toLocaleString("en-US", { timeZone, timeZoneName: 'longOffset' });
        const janGmtMatch = janFullOffset.match(/GMT([+-]\d+)/);
        if (!janGmtMatch) return false;
        const janOffset = parseInt(janGmtMatch[1], 10);

        // Numerikus GMT eltol√°s meghat√°roz√°sa j√∫liusra
        const julFullOffset = new Date(Date.UTC(year, 6, 1)).toLocaleString("en-US", { timeZone, timeZoneName: 'longOffset' });
        const julGmtMatch = julFullOffset.match(/GMT([+-]\d+)/);
        if (!julGmtMatch) return false;
        const julOffset = parseInt(julGmtMatch[1], 10);

        // Ha nincs k√ºl√∂nbs√©g a t√©li √©s ny√°ri eltol√°s k√∂z√∂tt, nincs ny√°ri id≈ësz√°m√≠t√°s
        if (janOffset === julOffset) {
            return false;
        }

        // Aktu√°lis d√°tum eltol√°s√°nak meghat√°roz√°sa
        const currentFullOffset = date.toLocaleString("en-US", { timeZone, timeZoneName: 'longOffset' });
        const currentGmtMatch = currentFullOffset.match(/GMT([+-]\d+)/);
        if (!currentGmtMatch) return false;
        const currentOffset = parseInt(currentGmtMatch[1], 10);

        // A t√©li id≈ësz√°m√≠t√°s (standard time) eltol√°sa mindig a kisebb numerikus √©rt√©k
        // (pl. a +1 kisebb, mint a +2; a +10 kisebb, mint a +11).
        const standardOffset = Math.min(janOffset, julOffset);

        // Egy d√°tum akkor van a ny√°ri id≈ësz√°m√≠t√°sban, ha az eltol√°sa nem egyezik a t√©li (standard) eltol√°ssal.
        return currentOffset !== standardOffset;

    } catch (e) {
        console.error("Hiba az isDaylightSavingTime f√ºggv√©nyben:", e);
        return false;
    }
}

        function getNextDSTChange(date, timeZone) {
            const year = date.getFullYear();
            for (let m = date.getMonth(); m < 12; m++) {
                for (let d = 1; d <= 31; d++) {
                    const testDate = new Date(year, m, d);
                    if (testDate.getMonth() !== m || testDate < date) continue;
                    
                    const prevDate = new Date(testDate.getTime() - 24 * 3600 * 1000);
                    const currentDST = isDaylightSavingTime(testDate, timeZone);
                    const prevDST = isDaylightSavingTime(prevDate, timeZone);

                    if (currentDST !== prevDST) return testDate;
                }
            }
            return getNextDSTChange(new Date(year + 1, 0, 1), timeZone);
        }

        function checkCurrentDayHolidays(date) { const dateStr = `${String(date.getUTCMonth() + 1).padStart(2, '0')}-${String(date.getUTCDate()).padStart(2, '0')}`; const year = date.getUTCFullYear(); let holidayMatches = []; for (const [key, holiday] of Object.entries(specialHolidays)) { if (holiday.date === dateStr) holidayMatches.push({ name: key, description: holiday.description }); else if (holiday.calculateDate) { const holidayDate = holiday.calculateDate(year); if (holidayDate.getUTCMonth() === date.getUTCMonth() && holidayDate.getUTCDate() === date.getUTCDate()) holidayMatches.push({ name: key, description: holiday.description }); } } const container = $('#currentDayHolidays').empty(); if (holidayMatches.length > 0) { container.html('<div class="holiday-match"><strong><i class="fas fa-star"></i> Mai jeles nap(ok):</strong>' + holidayMatches.map(m => `<span class="holiday-match-title">${m.name.charAt(0).toUpperCase() + m.name.slice(1)}</span><p style="margin: 0 0 5px 0;">${m.description}</p>`).join('') + '</div>'); } }
        function getNextSeason(date) { const year = date.getFullYear(), seasons = [{ name: 'tavasz', date: new Date(year, 2, 20) }, { name: 'ny√°r', date: new Date(year, 5, 21) }, { name: '≈ësz', date: new Date(year, 8, 23) }, { name: 't√©l', date: new Date(year, 11, 21) }]; for (let s of seasons) if (date < s.date) return s; return { name: 'tavasz', date: new Date(year + 1, 2, 20) }; }
        function getWeekNumber(date) { const first = new Date(date.getUTCFullYear(), 0, 1); return Math.ceil((((date - first) / 86400000) + first.getUTCDay() + 1) / 7); }
        function updateWorldClocks(now) { const cities = [ { id: 'timeLosAngeles', tz: 'America/Los_Angeles' }, { id: 'timeNewYork', tz: 'America/New_York' }, { id: 'timeLondon', tz: 'Europe/London' }, { id: 'timeMoscow', tz: 'Europe/Moscow' }, { id: 'timeDubai', tz: 'Asia/Dubai' }, { id: 'timeHongKong', tz: 'Asia/Hong_Kong' }, { id: 'timeTokyo', tz: 'Asia/Tokyo' }, { id: 'timeSydney', tz: 'Australia/Sydney' } ]; cities.forEach(c => { try { $(`#${c.id}`).text(now.toLocaleTimeString('hu-HU', { timeZone: c.tz, hour: '2-digit', minute: '2-digit' })); } catch (e) { $(`#${c.id}`).text('--:--'); }}); }
        function updateNamedays(now) { const todayStr = `${String(now.getUTCMonth() + 1).padStart(2, '0')}-${String(now.getUTCDate()).padStart(2, '0')}`; $('#todayNameday').text((namedays[todayStr] || ['Nincs adat']).join(', ')); const tomorrow = new Date(now); tomorrow.setUTCDate(now.getUTCDate() + 1); const tomorrowStr = `${String(tomorrow.getUTCMonth() + 1).padStart(2, '0')}-${String(tomorrow.getUTCDate()).padStart(2, '0')}`; $('#tomorrowNameday').text((namedays[tomorrowStr] || ['Nincs adat']).join(', ')); }
        
function updateAnniversaries(date) {
    const country = availableCountries.find(c => c.countryCode === selectedCountry);
    $('#anniversaryCountry').text(`(${(country ? country.name : '')})`);
    const wikiLang = getWikiLanguageCode(selectedCountry);
    const day = date.getUTCDate();
    
    let monthName;
    if (wikiLang === 'hu') {
        monthName = ['janu√°r', 'febru√°r', 'm√°rcius', '√°prilis', 'm√°jus', 'j√∫nius', 
                     'j√∫lius', 'augusztus', 'szeptember', 'okt√≥ber', 'november', 'december'][date.getUTCMonth()];
    } else {
        monthName = date.toLocaleDateString('en-US', { month: 'long', timeZone: 'UTC' });
    }
    
    const pageTitle = (wikiLang === 'hu') ? `${monthName}_${day}.` : `${monthName}_${day}`;
    
    $('#anniversaryWikiLink').attr('href', `https://${wikiLang}.wikipedia.org/wiki/${encodeURIComponent(pageTitle)}`);
    
    $.ajax({
        url: `https://${wikiLang}.wikipedia.org/w/api.php`,
        dataType: 'jsonp',
        data: {
            action: 'query',
            prop: 'extracts',
            titles: pageTitle,
            format: 'json',
            exintro: false,
            explaintext: false,
            exsectionformat: 'wiki'
        },
        success: function(data) {
            if (data && data.query && data.query.pages) {
                const pages = data.query.pages;
                const pageId = Object.keys(pages)[0];
                const page = pages[pageId];
                
                if (page && page.extract) {
                    const extract = page.extract;
                    
                    // Esem√©nyek keres√©se a sz√∂vegben
                    let eventsContent = '';
                    
                    if (wikiLang === 'hu') {
                        const eventsMatch = extract.match(/==\s*Esem√©nyek\s*==([^=]+)/);
                        if (eventsMatch) {
                            const events = eventsMatch[1].split('\n')
                                .filter(line => line.trim().startsWith('*'))
                                .slice(0, 15)
                                .map(line => line.replace(/^\*\s*/, '').trim())
                                .filter(line => line.length > 0);
                            
                            if (events.length > 0) {
                                eventsContent = events.map(event => 
                                    `<div class="notable-day-item">${event}</div>`
                                ).join('');
                            }
                        }
                    } else {
                        // Angol √©s m√°s nyelvekhez
                        const eventsMatch = extract.match(/==\s*Events\s*==([^=]+)/);
                        if (eventsMatch) {
                            const events = eventsMatch[1].split('\n')
                                .filter(line => line.trim().startsWith('*'))
                                .slice(0, 15)
                                .map(line => line.replace(/^\*\s*/, '').trim())
                                .filter(line => line.length > 0);
                            
                            if (events.length > 0) {
                                eventsContent = events.map(event => 
                                    `<div class="notable-day-item">${event}</div>`
                                ).join('');
                            }
                        }
                    }
                    
                    if (eventsContent) {
                        $('#anniversaryContent').html(eventsContent);
                    } else {
                        // Ha nem tal√°lunk esem√©nyeket, pr√≥b√°ljuk meg parse API-val
                        fallbackToParseAPI(wikiLang, pageTitle);
                    }
                } else {
                    $('#anniversaryContent').html('<p style="text-align: center; opacity: 0.7;">Nincs adat erre a napra.</p>');
                }
            } else {
                $('#anniversaryContent').html('<p style="text-align: center; opacity: 0.7;">Nincs adat erre a napra.</p>');
            }
        },
        error: function() {
            $('#anniversaryContent').html('<p style="text-align: center; opacity: 0.7;">Az √©vfordul√≥k nem el√©rhet≈ëk.</p>');
        }
    });
}

// Tartal√©k f√ºggv√©ny a parse API haszn√°lat√°hoz
function fallbackToParseAPI(wikiLang, pageTitle) {
    $.ajax({
        url: `https://${wikiLang}.wikipedia.org/w/api.php`,
        dataType: 'jsonp',
        data: {
            action: 'parse',
            page: pageTitle,
            prop: 'sections',
            format: 'json'
        },
        success: function(data) {
            if (data && data.parse && data.parse.sections) {
                const eventSection = data.parse.sections.find(s => 
                    s.line === 'Esem√©nyek' || s.line === 'Events' || 
                    s.line === 'Ereignisse' || s.line === '√âv√©nements'
                );
                
                if (eventSection) {
                    // Ha van esem√©ny szekci√≥, pr√≥b√°ljuk meg lek√©rni a tartalmat
                    $.ajax({
                        url: `https://${wikiLang}.wikipedia.org/w/api.php`,
                        dataType: 'jsonp',
                        data: {
                            action: 'parse',
                            page: pageTitle,
                            prop: 'text',
                            section: eventSection.index,
                            format: 'json'
                        },
                        success: function(data) {
                            if (data && data.parse && data.parse.text) {
                                const html = $('<div>').html(data.parse.text['*']);
                                const events = html.find('li').slice(0, 15);
                                
                                if (events.length > 0) {
                                    let eventsHtml = '';
                                    events.each(function() {
                                        const text = $(this).text().trim();
                                        if (text) {
                                            eventsHtml += `<div class="notable-day-item">${text}</div>`;
                                        }
                                    });
                                    $('#anniversaryContent').html(eventsHtml);
                                } else {
                                    $('#anniversaryContent').html('<p style="text-align: center; opacity: 0.7;">Nincs r√∂gz√≠tett esem√©ny erre a napra.</p>');
                                }
                            }
                        }
                    });
                }
            }
        }
    });
}

        function getWikiLanguageCode(cc) { const map = { 'HU': 'hu', 'DE': 'de', 'AT': 'de', 'CH': 'de', 'FR': 'fr', 'ES': 'es', 'IT': 'it', 'PT': 'pt', 'GB': 'en', 'US': 'en', 'PL': 'pl', 'CZ': 'cs', 'SK': 'sk', 'RO': 'ro', 'RU': 'ru', 'JP': 'ja', 'CN': 'zh' }; return map[cc] || 'en'; }
        function changeNotableDay(dir) { currentNotableDate.setUTCDate(currentNotableDate.getUTCDate() + dir); const dateStr = currentNotableDate.toISOString().split('T')[0]; $('#notableDatePicker').val(dateStr); checkCurrentDayHolidays(currentNotableDate); updateAnniversaries(currentNotableDate); }
        function goToNotableToday() { currentNotableDate = new Date(); const todayStr = currentNotableDate.toISOString().split('T')[0]; $('#notableDatePicker').val(todayStr); checkCurrentDayHolidays(new Date(Date.now())); updateAnniversaries(currentNotableDate); }
        function goToNotableDate() { const sel = $('#notableDatePicker').val(); if (sel) { currentNotableDate = new Date(sel + "T12:00:00Z"); checkCurrentDayHolidays(currentNotableDate); updateAnniversaries(currentNotableDate); } }
        $('#specialHolidaySearch').on('input', function() { const term = $(this).val().toLowerCase().trim(), container = $('#specialHolidayResults').empty(); if (term.length < 3) return; let html = ''; for (const [key, h] of Object.entries(specialHolidays)) { if (key.includes(term) || h.description.toLowerCase().includes(term)) { let dateStr = h.calculateDate ? h.calculateDate(new Date().getFullYear()).toLocaleDateString('hu-HU', { month: 'long', day: 'numeric', timeZone: 'UTC' }) : new Date(2000, h.date.split('-')[0]-1, h.date.split('-')[1]).toLocaleDateString('hu-HU', { month: 'long', day: 'numeric'}); html += `<div class="search-result-item"><strong>${key.charAt(0).toUpperCase() + key.slice(1)}</strong><br><small>${h.description} (${dateStr})</small></div>`; } } container.html(html || '<div class="search-result-item" style="border-left-color: #999;">Nincs tal√°lat</div>'); });
        $('#namedaySearch').on('input', function() { const term = $(this).val().toLowerCase(), res = $('#namedaySearchResult').empty(); if (term.length < 2) return; let results = []; for (let [date, names] of Object.entries(namedays)) { for (let name of names) { if (name.toLowerCase().includes(term)) { const [month, day] = date.split('-'); results.push(`<div><strong>${name}</strong>: ${new Date(2000, month - 1, day).toLocaleDateString('hu-HU', { month: 'long', day: 'numeric' })}</div>`); } } } res.html(results.slice(0, 5).join('') || '<div style="color: #999;">Nincs tal√°lat</div>'); });
        function updateZodiacSigns(date) { const zodiacs = [ {n: 'Bak', s: [1, 1], e: [1, 19]}, {n: 'V√≠z√∂nt≈ë', s: [1, 20], e: [2, 18]}, {n: 'Halak', s: [2, 19], e: [3, 20]}, {n: 'Kos', s: [3, 21], e: [4, 19]}, {n: 'Bika', s: [4, 20], e: [5, 20]}, {n: 'Ikrek', s: [5, 21], e: [6, 20]}, {n: 'R√°k', s: [6, 21], e: [7, 22]}, {n: 'Oroszl√°n', s: [7, 23], e: [8, 22]}, {n: 'Sz≈±z', s: [8, 23], e: [9, 22]}, {n: 'M√©rleg', s: [9, 23], e: [10, 22]}, {n: 'Skorpi√≥', s: [10, 23], e: [11, 21]}, {n: 'Nyilas', s: [11, 22], e: [12, 21]}, {n: 'Bak', s: [12, 22], e: [12, 31]} ]; const month = date.getUTCMonth() + 1, day = date.getUTCDate(); $('#sunZodiac').text(zodiacs.find(z => (month === z.s[0] && day >= z.s[1]) || (month === z.e[0] && day <= z.e[1])).n); const moonAge = (date - new Date(2000, 0, 6, 18, 14)) / 86400000 % 27.321661; $('#moonZodiac').text(['Kos', 'Bika', 'Ikrek', 'R√°k', 'Oroszl√°n', 'Sz≈±z', 'M√©rleg', 'Skorpi√≥', 'Nyilas', 'Bak', 'V√≠z√∂nt≈ë', 'Halak'][Math.floor(moonAge / 27.321661 * 12)]); }
        function updateCountdowns(now) { const year = now.getUTCFullYear(); let easter = calculateEaster(year); if (now > easter) easter = calculateEaster(year + 1); $('#daysToEaster').text(Math.ceil((easter - now) / 86400000)); let christmas = new Date(Date.UTC(year, 11, 25)); if (now > christmas) christmas = new Date(Date.UTC(year + 1, 11, 25)); $('#daysToChristmas').text(Math.ceil((christmas - now) / 86400000)); $('#daysToNewYear').text(Math.ceil((new Date(Date.UTC(year + 1, 0, 1)) - now) / 86400000)); const dstDate = getNextDSTChange(now, weatherData ? weatherData.timezone : Intl.DateTimeFormat().resolvedOptions().timeZone); $('#daysToDST').text(Math.ceil((dstDate - now) / 86400000)); $('#dstLabel').text(`nap a v√°lt√°sig`); const nextSeason = getNextSeason(now); $('#daysToNextSeason').text(Math.ceil((nextSeason.date - now) / 86400000)); $('#nextSeasonLabel').text(`nap ${nextSeason.name} kezdet√©ig`); }
        function getWeatherData() { const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${userLat}&longitude=${userLon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,precipitation,weather_code,cloud_cover,pressure_msl,wind_speed_10m,wind_gusts_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_sum,precipitation_probability_max&timezone=auto&forecast_days=3`; $.ajax({ url: apiUrl, success: function(data) { weatherData = data; $('#weatherLoading').hide(); $('#weatherContent').show(); updateWeatherDisplay(data); updateSunMoonTimes(data); }, error: () => $('#weatherLoading').html('<p style="color: red;">Id≈ëj√°r√°s bet√∂lt√©se sikertelen</p>') }); }
        function updateWeatherDisplay(data) { const { current, daily } = data; $('#currentWeatherIcon').html(getWeatherIcon(current.weather_code, current.is_day)); $('#currentTemp').text(`${Math.round(current.temperature_2m)}¬∞C`); $('#currentCondition').text(getWeatherDescription(current.weather_code)); $('#feelsLike').text(`H≈ë√©rzet: ${Math.round(current.apparent_temperature)}¬∞C`); const details = [ { l: 'Sz√©l', v: `${Math.round(current.wind_speed_10m)} km/h`, i: 'wind' }, { l: 'L√∂k√©sek', v: `${Math.round(current.wind_gusts_10m)} km/h`, i: 'wind' }, { l: 'P√°ra', v: `${current.relative_humidity_2m}%`, i: 'tint' }, { l: 'L√©gnyom√°s', v: `${Math.round(current.pressure_msl)} hPa`, i: 'tachometer-alt' } ]; $('#weatherDetails').html(details.map(d => `<div class="weather-detail-item"><span class="weather-detail-label"><i class="fas fa-${d.i}"></i> ${d.l}</span><span class="weather-detail-value">${d.v}</span></div>`).join('')); let fHtml = ''; for (let i = 0; i < 3; i++) { fHtml += `<div style="text-align:center;padding:10px;background:rgba(0,0,0,0.05);border-radius:10px;"><strong>${new Date(daily.time[i]).toLocaleDateString('hu-HU',{weekday:'short'})}</strong><div style="font-size:2em;">${getWeatherIcon(daily.weather_code[i],true)}</div><div><span style="color:red;">${Math.round(daily.temperature_2m_max[i])}¬∞</span>/<span style="color:blue;">${Math.round(daily.temperature_2m_min[i])}¬∞</span></div></div>`; } $('#forecast').html(fHtml); }
        function updateSunMoonTimes(data) { const timeToMinutes = (ts) => { const [h, m] = ts.split(':').map(Number); return h * 60 + m; }; const sunriseMins = timeToMinutes(data.daily.sunrise[0].split('T')[1]); const sunsetMins = timeToMinutes(data.daily.sunset[0].split('T')[1]); const sunrisePercent = (sunriseMins / 1440) * 100, sunsetPercent = (sunsetMins / 1440) * 100, noonPercent = (sunrisePercent + sunsetPercent) / 2; $('#sunScale').css('background', `linear-gradient(to right, #1a1a2e ${sunrisePercent-5}%, #87ceeb ${sunrisePercent+5}%, #ffce45 ${noonPercent}%, #ff6b6b ${sunsetPercent-5}%, #1a1a2e ${sunsetPercent+5}%)`); $('#sunriseTime').text(data.daily.sunrise[0].split('T')[1]); $('#sunsetTime').text(data.daily.sunset[0].split('T')[1]); $('#sunScaleMarkers').html(`<div class="time-marker sunrise-marker" style="left:${sunrisePercent}%"></div><div class="time-marker noon-marker" style="left:${noonPercent}%"></div><div class="time-marker sunset-marker" style="left:${sunsetPercent}%"></div>`); updateSunPosition(); if (sunUpdateInterval) clearInterval(sunUpdateInterval); sunUpdateInterval = setInterval(updateSunPosition, 60000); const moonTimes = SunCalc.getMoonTimes(new Date(data.daily.time[0]), userLat, userLon); $('#sunMoonTimes').html(`<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px;"><div style="text-align:center"><i class="fas fa-sun sun-icon"></i><div>Napkelte</div><strong>${data.daily.sunrise[0].split('T')[1]}</strong></div><div style="text-align:center"><i class="fas fa-sun" style="color:#e74c3c;font-size:1.5em"></i><div>Napnyugta</div><strong>${data.daily.sunset[0].split('T')[1]}</strong></div><div style="text-align:center"><i class="fas fa-moon moon-icon"></i><div>Holdkelte</div><strong>${moonTimes.rise?moonTimes.rise.toLocaleTimeString('hu-HU',{hour:'2-digit',minute:'2-digit'}) : 'N/A'}</strong></div><div style="text-align:center"><i class="fas fa-moon" style="color:#9b59b6;font-size:1.5em"></i><div>Holdnyugta</div><strong>${moonTimes.set?moonTimes.set.toLocaleTimeString('hu-HU',{hour:'2-digit',minute:'2-digit'}) : 'N/A'}</strong></div></div>`); }
        function updateSunPosition() { if (!weatherData) return; const timeToMinutes = (ts) => { const [h, m] = ts.split(':').map(Number); return h * 60 + m; }; const nowInLocation = new Date().toLocaleTimeString('en-GB', { timeZone: weatherData.timezone, hour12: false, hour: '2-digit', minute: '2-digit'}); $('#sunPosition').css('left', `${(timeToMinutes(nowInLocation) / 1440) * 100}%`); }
        
        // JAV√çTVA: Holdf√°zis grafika logik√°ja
function updateMoonPhase() {
    const illum = SunCalc.getMoonIllumination(new Date());
    const phase = illum.phase;
    const illuminated = illum.fraction;
    const isNorthernHemisphere = userLat >= 0;
    
    const visual = $('#moonVisual');
    const overlay = $('#moonPhaseOverlay');
    
    // Tiszt√≠tsuk meg az el≈ëz≈ë st√≠lusokat
    visual.attr('style', '');
    overlay.attr('style', '');
    
    // Alapst√≠lusok √∫jra alkalmaz√°sa
    visual.css({
        'width': '150px',
        'height': '150px',
        'border-radius': '50%',
        'margin': '15px auto',
        'position': 'relative',
        'box-shadow': 'inset -10px -10px 20px rgba(0, 0, 0, 0.1), 0 0 10px rgba(255, 255, 255, 0.3)',
        'overflow': 'hidden',
        'background': '#e0e0e0'
    });
    
    // F√©lk√∂r overlay l√©trehoz√°sa a holdf√°zishoz
    let overlayStyle = {
        'position': 'absolute',
        'top': '0',
        'width': '150px',
        'height': '150px',
        'border-radius': '50%'
    };
    
    // F√°zis alapj√°n be√°ll√≠tjuk az overlay poz√≠ci√≥j√°t √©s m√©ret√©t
    if (phase < 0.25) {
        // N√∂vekv≈ë hold (jobb oldal vil√°gos)
        const width = (1 - phase * 4) * 150;
        overlayStyle['width'] = width + 'px';
        overlayStyle['right'] = '0';
        overlayStyle['background'] = '#2c2c2c';
    } else if (phase < 0.5) {
        // N√∂vekv≈ë hold telihold fel√© (bal oldal kezd vil√°gosodni)
        const width = ((phase - 0.25) * 4) * 150;
        overlayStyle['width'] = width + 'px';
        overlayStyle['left'] = '0';
        overlayStyle['background'] = '#e0e0e0';
        visual.css('background', '#2c2c2c');
    } else if (phase < 0.75) {
        // Fogy√≥ hold (bal oldal s√∂t√©tedik)
        const width = ((phase - 0.5) * 4) * 150;
        overlayStyle['width'] = width + 'px';
        overlayStyle['left'] = '0';
        overlayStyle['background'] = '#2c2c2c';
    } else {
        // Fogy√≥ hold √∫jhold fel√© (jobb oldal is s√∂t√©tedik)
        const width = (1 - (phase - 0.75) * 4) * 150;
        overlayStyle['width'] = width + 'px';
        overlayStyle['right'] = '0';
        overlayStyle['background'] = '#e0e0e0';
        visual.css('background', '#2c2c2c');
    }
    
    // D√©li f√©ltek√©n ford√≠tott a n√©zet
    if (!isNorthernHemisphere) {
        if (overlayStyle['left'] !== undefined) {
            overlayStyle['right'] = overlayStyle['left'];
            delete overlayStyle['left'];
        } else if (overlayStyle['right'] !== undefined) {
            overlayStyle['left'] = overlayStyle['right'];
            delete overlayStyle['right'];
        }
    }
    
    overlay.css(overlayStyle);
    
    // F√°zis neve
    let phaseName = '';
    if (phase < 0.03 || phase > 0.97) phaseName = '√öjhold';
    else if (phase < 0.23) phaseName = 'N√∂vekv≈ë sarl√≥';
    else if (phase < 0.27) phaseName = 'Els≈ë negyed';
    else if (phase < 0.48) phaseName = 'N√∂vekv≈ë hold';
    else if (phase < 0.52) phaseName = 'Telihold';
    else if (phase < 0.73) phaseName = 'Fogy√≥ hold';
    else if (phase < 0.77) phaseName = 'Utols√≥ negyed';
    else phaseName = 'Fogy√≥ sarl√≥';

    $('#moonPhaseName').text(phaseName);
    $('#moonPhasePercent').text(`Megvil√°g√≠t√°s: ${Math.round(illuminated * 100)}%`);
    $('#moonLocationNote').text(`(${isNorthernHemisphere ? '√âszaki' : 'D√©li'} f√©lteke n√©zet)`);
}

        function getHolidays(y, c) { const k = `${y}-${c}`; if (holidaysCache[k]) return Promise.resolve(holidaysCache[k]); return $.ajax({ url: `https://date.nager.at/api/v3/PublicHolidays/${y}/${c}`, success: d => holidaysCache[k] = d, error: () => [] }); }
        function getLongWeekends(y, c) { const k = `${y}-${c}`; if (longWeekendsCache[k]) return Promise.resolve(longWeekendsCache[k]); return $.ajax({ url: `https://date.nager.at/api/v3/LongWeekend/${y}/${c}`, success: d => longWeekendsCache[k] = d, error: () => [] }); }
        function renderCalendar() { const y = currentCalendarDate.getFullYear(), m = currentCalendarDate.getMonth(); $('#calendarMonthYear').text(currentCalendarDate.toLocaleDateString('hu-HU', { year: 'numeric', month: 'long' })); Promise.all([getHolidays(y, selectedCountry), getLongWeekends(y, selectedCountry)]).then(([holidays, longWeekends]) => { let html = ['H', 'K', 'Sz', 'Cs', 'P', 'Sz', '<span style="color:#e74c3c">V</span>'].map(d => `<div style="text-align:center;font-weight:bold;padding:5px;">${d}</div>`).join(''); const firstDay = new Date(y, m, 1).getDay(); html += '<div></div>'.repeat(firstDay === 0 ? 6 : firstDay - 1); const today = new Date(); for (let day = 1; day <= new Date(y, m + 1, 0).getDate(); day++) { const dateStr = `${y}-${String(m + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`; const h = holidays.find(h => h.date === dateStr); const isT = y === today.getFullYear() && m === today.getMonth() && day === today.getDate(); const isS = new Date(y, m, day).getDay() === 0; let cls = ['calendar-day']; if (h) cls.push('holiday'); if (isT) cls.push('today'); if (isS && !h) cls.push('sunday'); html += `<div class="${cls.join(' ')}" ${h ? `title="${h.localName || h.name}"` : ''}>${day}</div>`; } $('#calendarGrid').html(html); $('#longWeekends').html(longWeekends.length > 0 ? '<h4>Hossz√∫ h√©tv√©g√©k:</h4>' + longWeekends.map(w => `<div style="padding:8px;margin:5px 0;background:rgba(0,200,0,0.1);border-radius:8px;border-left:4px solid #2ecc71"><strong>${new Date(w.startDate).toLocaleDateString('hu-HU',{month:'short',day:'numeric'})} - ${new Date(w.endDate).toLocaleDateString('hu-HU',{month:'short',day:'numeric'})}</strong> (${w.dayCount} nap)</div>`).join('') : ''); }); }
        function changeMonth(d) { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + d); renderCalendar(); }
        function goToToday() { currentCalendarDate = new Date(); renderCalendar(); }
        $('#countrySelect').on('change', function() { selectedCountry = $(this).val(); renderCalendar(); updateAnniversaries(currentNotableDate); });
        function initRadarMap() { if (radarMap) radarMap.remove(); radarMap = L.map('radar-map').setView([userLat, userLon], 8); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(radarMap); currentLocationMarker = L.marker([userLat, userLon], { icon: L.divIcon({ className: 'leaflet-marker-icon', html: '<i class="fas fa-map-marker-alt" style="color:#e74c3c;font-size:24px;text-shadow:0 0 3px #fff;"></i>', iconSize: [24, 24], iconAnchor: [12, 24] }) }).addTo(radarMap); loadRadarLayers(); }
        function loadRadarLayers(c = '2') { $.ajax({ url: 'https://api.rainviewer.com/public/weather-maps.json', success: function(d) { if (radarLayers.length) radarLayers.forEach(l => radarMap.removeLayer(l.layer)); radarLayers = []; const frames = [...d.radar.past, ...d.radar.nowcast]; frames.forEach(f => radarLayers.push({ layer: L.tileLayer(`${d.host}${f.path}/256/{z}/{x}/{y}/${c}/1_1.png`, { opacity: 0, zIndex: f.time }).addTo(radarMap), time: f.time })); if (radarLayers.length) { radarAnimationPosition = d.radar.past.length - 1; updateRadarDisplay(); } } }); }
        function updateRadarDisplay() { radarLayers.forEach((item, i) => item.layer.setOpacity(i === radarAnimationPosition ? 0.7 : 0)); if (radarLayers[radarAnimationPosition]) $('#radarTime').text(new Date(radarLayers[radarAnimationPosition].time * 1000).toLocaleString('hu-HU') + (radarAnimationPosition >= radarLayers.length - 12 ? ' (El≈ërejelz√©s)' : '')); }
        function toggleRadarAnimation() { isRadarPlaying = !isRadarPlaying; if (isRadarPlaying) { $('#playRadar i').removeClass('fa-play').addClass('fa-pause'); animateRadar(); } else { clearTimeout(radarAnimationTimer); $('#playRadar i').removeClass('fa-pause').addClass('fa-play'); } }
        function animateRadar() { radarAnimationPosition = (radarAnimationPosition + 1) % radarLayers.length; updateRadarDisplay(); if (isRadarPlaying) radarAnimationTimer = setTimeout(animateRadar, 500); }
        function getEarthquakeData() { $.ajax({ url: `https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson`, success: function(d) { mostRecentEarthquakeTime = d.features.length ? d.features[0].properties.time : Date.now(); $('#earthquakeList').html(d.features.slice(0, 15).map(q => `<div class="earthquake-item"><div class="magnitude">M${q.properties.mag.toFixed(1)}</div><div class="earthquake-location" title="${q.properties.place}">${q.properties.place}</div><div class="earthquake-time">${new Date(q.properties.time).toLocaleString('hu-HU')}</div></div>`).join('') || '<p style="text-align:center;">Nincs reng√©s az elm√∫lt 24 √≥r√°ban</p>'); updateEarthquakeTimer(); }, error: () => $('#earthquakeList').html('<p style="color:red;text-align:center;">Adatok bet√∂lt√©se sikertelen</p>') }); }
        function updateEarthquakeTimer() { if (earthquakeUpdateTimer) clearInterval(earthquakeUpdateTimer); earthquakeUpdateTimer = setInterval(() => { if (mostRecentEarthquakeTime) { const diff = (Date.now() - mostRecentEarthquakeTime) / 1000, h = Math.floor(diff / 3600), m = Math.floor(diff % 3600 / 60); $('#earthquakeTimer').text(`${h > 0 ? h + ' √≥ra ' : ''}${m} perc telt el az utols√≥ reng√©s √≥ta`); } }, 1000); }
        function getAuroraForecast() { const baseKp = Math.random() * 4 + 1; let html = ''; for(let i=0; i<8; i++){ const kp = Math.max(0, Math.min(9, baseKp + (Math.random() - 0.5) * 2)).toFixed(1); if (i === 0) { $('#kpIndex, #kpValue').text(kp); $('#auroraIndicator').css('left', `calc(${(kp / 9) * 100}% - 20px)`); $('#auroraVisibility').html(calculateAuroraVisibility(kp, userLat)); } const vis = calculateAuroraVisibility(kp, userLat); html += `<tr><td>${i===0 ? 'Most' : i*3+' √≥ra'}</td><td><strong>${kp}</strong></td><td style="color:${vis.includes('L√°that√≥') ? '#2ecc71':'#e74c3c'}">${vis.includes('L√°that√≥') ? 'Lehets√©ges':'Nem val√≥sz√≠n≈±'}</td></tr>`; } $('#auroraForecastTable').html(html); $('#auroraLocation').text(`Helysz√≠n: ${userLocation} (${Math.abs(userLat).toFixed(2)}¬∞${userLat >= 0 ? '√â' : 'D'})`); }
        function calculateAuroraVisibility(kp, lat) { const map = { 0:66.5, 1:64.5, 2:62.5, 3:60.5, 4:58.5, 5:56.5, 6:54.5, 7:52.5, 8:50.5, 9:48.5 }; const minLat = map[Math.floor(kp)] || 66.5, absLat = Math.abs(lat); if (absLat >= minLat) return `<strong style="color:#2ecc71;">L√°that√≥ lehet!</strong>`; if (absLat >= minLat - 5) return `<strong style="color:#f39c12;">Alacsony es√©ly</strong>`; return `<strong style="color:#e74c3c;">Nem l√°that√≥</strong>`; }
        
        function initializeAll() {
            updateTitle(userLocation);
            $('#currentLocation').text(userLocation);
            getWeatherData(); renderCalendar();
            const today = new Date(); currentNotableDate = today;
            $('#notableDatePicker').val(today.toISOString().split('T')[0]);
            checkCurrentDayHolidays(new Date(Date.now())); updateAnniversaries(today);
            if (radarMap) { radarMap.setView([userLat, userLon], 8); if (currentLocationMarker) currentLocationMarker.setLatLng([userLat, userLon]); loadRadarLayers(); } else { initRadarMap(); }
            getEarthquakeData(); getAuroraForecast(); updateMoonPhase();
        }

        $(document).ready(function() {
            loadCountries(); setDaytimeColors(); getCurrentLocation();
            setInterval(updateTime, 1000); setInterval(setDaytimeColors, 60000); setInterval(updateMoonPhase, 300000);
            setInterval(getEarthquakeData, 300000); setInterval(getAuroraForecast, 600000); setInterval(getWeatherData, 900000);
            $('#locationInput').keypress(e => { if (e.which == 13) updateLocation(); });
            $(window).resize(() => { if (radarMap) radarMap.invalidateSize(true); });
        });
        window.onerror = (msg, url, line) => console.error('Hiba:', msg, url, line);
    </script>
</body>
</html>